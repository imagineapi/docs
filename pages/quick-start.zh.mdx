import { Callout, Tab, Tabs, Steps } from 'nextra/components'

# ä½¿ç”¨æˆ‘ä»¬çš„Midjourney APIå¿«é€Ÿå…¥é—¨

## æ¦‚è¿°

æœ¬æŒ‡å—å‡å®šæ‚¨æ­£åœ¨ä½¿ç”¨[æ¼”ç¤ºå¸æˆ·](https://www.imagineapi.dev/pricing)ã€‚æˆ‘ä»¬å°†é€šè¿‡ç”Ÿæˆä¸€å¼ å›¾ç‰‡å¹¶æŸ¥çœ‹ç»“æœæ¥å¿«é€Ÿå¼€å§‹ã€‚æ‚¨ä¹Ÿå¯ä»¥é€‰æ‹©ä½¿ç”¨çš„ç¼–ç¨‹è¯­è¨€ã€‚

æœ€å¥½çš„éƒ¨åˆ†æ˜¯ï¼Œæ‚¨å¯ä»¥å¤åˆ¶ä»£ç å¹¶ç«‹å³ä½¿ç”¨ï¼

<Callout type="info" emoji="ğŸš€">
**é€šè¿‡è·å–[æ¼”ç¤ºå¸æˆ·](https://www.imagineapi.dev/pricing)æœ€ç®€å•çš„å¼€å§‹ç”ŸæˆMidjourneyå›¾ç‰‡çš„æ–¹æ³•ã€‚**
</Callout>

<Steps>

### è·å–èº«ä»½éªŒè¯ä»¤ç‰Œ

![ç”Ÿæˆèº«ä»½éªŒè¯ä»¤ç‰Œçš„æ­¥éª¤åŠ¨ç”»](/authentication.gif)

1. ä¸€æ—¦è´­ä¹°äº†[æ¼”ç¤ºå¸æˆ·](https://www.imagineapi.dev/pricing)ï¼Œæ‚¨å°†æ”¶åˆ°ä¸€å°åŒ…å«ç”¨æˆ·åå’Œå¯†ç çš„ç”µå­é‚®ä»¶ã€‚ä½¿ç”¨å®ƒç™»å½•åˆ°æˆ‘ä»¬çš„æ¼”ç¤ºæœåŠ¡å™¨ï¼š[https://demo.imagineapi.dev](https://demo.imagineapi.dev)ã€‚
1. ç™»å½•åï¼Œç‚¹å‡»å·¦ä¸‹è§’çš„ `ç”¨æˆ·å›¾æ ‡`ï¼š![](/authentication-token.png)
1. è¿™æ˜¯æ‚¨çš„ç”¨æˆ·è®¾ç½®ã€‚æ»šåŠ¨åˆ°åº•éƒ¨ï¼Œæ‰¾åˆ° `Token` å­—æ®µå¹¶ `ç‚¹å‡»åœ†å½¢ç®­å¤´æŒ‰é’®` ä»¥é‡æ–°ç”Ÿæˆä»¤ç‰Œï¼š![](/authentication-click-regenerate.png)
1. è¿™å°†åˆ›å»ºä¸€ä¸ªæ–°çš„ä»¤ç‰Œï¼Œæ‚¨å¯ä»¥ç”¨å®ƒæ¥æˆæƒæ‚¨çš„APIè°ƒç”¨ï¼Œæ‰€ä»¥ `å¤åˆ¶è¯¥ä»¤ç‰Œ`ã€‚è¯·å°†å®ƒä¿å­˜åœ¨æŸä¸ªæ–‡ä»¶ä¸­ï¼Œå› ä¸ºæ‚¨å¾ˆå¿«å°±ä¼šç”¨åˆ°å®ƒï¼š![](/authentication-copy-token.png)
1. ç„¶å `ç‚¹å‡»å³ä¸Šè§’çš„å¤é€‰æ¡†æŒ‰é’®` ä»¥ä¿å­˜æ‚¨çš„å¸æˆ·æ›´æ”¹ï¼š![](/authentication-save-account-changes.png)

å°±æ˜¯è¿™æ ·ã€‚ç°åœ¨æˆ‘ä»¬å°†ä½¿ç”¨è¯¥ä»¤ç‰Œæ¥éªŒè¯æˆ‘ä»¬çš„APIè°ƒç”¨ã€‚

### ç”Ÿæˆä¸€å¼ å›¾ç‰‡

ç°åœ¨æ‚¨æ‹¥æœ‰æ‚¨çš„[èº«ä»½éªŒè¯ä»¤ç‰Œ](#è·å–èº«ä»½éªŒè¯ä»¤ç‰Œ)ï¼Œæ‚¨å¯ä»¥ç”Ÿæˆæ‚¨çš„ç¬¬ä¸€å¼ å›¾ç‰‡ã€‚

```js filename="midjourney-api.js" copy showLineNumbers
// ä½¿ç”¨fetch - éœ€è¦Node.js 18æˆ–æ›´é«˜ç‰ˆæœ¬

const data = {
    prompt: "a pretty lady at the beach --ar 9:21 --chaos 40 --stylize 1000"
};

// æˆ‘ä»¬åœ¨è¿™é‡Œå°†å…¶åŒ…è£…åœ¨ä¸€ä¸ªä¸»å‡½æ•°ä¸­ï¼Œä»¥ä¾¿æˆ‘ä»¬å¯ä»¥åœ¨å…¶ä¸­ä½¿ç”¨async/awaitã€‚
async function main() {
    try {
        const response = await fetch('https://demo.imagineapi.dev/items/images/', {
            method: 'POST',
            headers: {
                'Authorization': 'Bearer u667iLDO2Xfu0-qpv_nu82EeeDtYGlsf', // <<<< TODO: è®°å¾—æ›´æ”¹è¿™ä¸ª
                'Content-Type': 'application/json'
            },
            body: JSON.stringify(data)
        });

        const responseData = await response.json();
        console.log(responseData);
    } catch (error) {
        console.error('ç”Ÿæˆå›¾åƒæ—¶å‡ºé”™ï¼š', error);
        throw error;
    }
}

main();
```

æˆ‘ä»¬ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤è¿è¡Œå®ƒï¼ˆéœ€è¦Node.js 18æˆ–æ›´é«˜ç‰ˆæœ¬ï¼‰ï¼š

```shell
â¯ node --version
v18.14.0

â¯ node midjourney-api.js
```

è¾“å‡ºå°†å¦‚ä¸‹æ‰€ç¤ºï¼š

```js
{
  data: {
    id: '8fd5bc67-a4c5-4bf0-a09d-e20341d17135',
    prompt: 'a pretty lady at the beach --ar 9:21 --chaos 40 --stylize 1000',
    results: null,
    user_created: '4df804f1-e32e-4e1c-be58-6acbe48cce98',
    date_created: '2023-09-01T04:33:44.939Z',
    status: 'pending',
    progress: null,
    url: null,
    error: null,
    upscaled_urls: null,
    upscaled: []
  }
}
```

ç°åœ¨æ‚¨çš„æç¤ºå°†è¢«å‘é€åˆ°Midjourneyã€‚

éœ€è¦æ³¨æ„çš„ä¸€äº›é‡è¦ç»†èŠ‚ï¼š

- å›¾åƒ `id` å°†ä¿æŒä¸å˜ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨å®ƒæ¥è·å–æ•°æ®å’ŒçŠ¶æ€
- `status` æ˜¯ `pending`ï¼Œè¿™æ˜¯é¦–æ¬¡åˆ›å»ºå›¾åƒç”Ÿæˆæ—¶çš„é»˜è®¤å€¼
- å½“å®Œæˆç”Ÿæˆï¼ˆ`status` å°†ä¸º `completed`ï¼‰æ—¶ï¼Œ`upscaled_urls` å°†å…·æœ‰4ä¸ªç‹¬ç«‹çš„å›¾åƒURLï¼Œè€Œ `url` å°†å…·æœ‰å…¶ä¸­åŒ…å«æ‰€æœ‰å››ä¸ªå›¾åƒçš„ç½‘æ ¼å›¾åƒ

è®©æˆ‘ä»¬ç»§ç»­ä¸‹é¢ï¼Œå¹¶[è·å–ç”Ÿæˆçš„å›¾åƒ](#è·å–ç”Ÿæˆçš„å›¾åƒ)ã€‚

### è·å–ç”Ÿæˆçš„å›¾åƒ

åœ¨æ¼”ç¤ºæœåŠ¡å™¨ä¸­ç”Ÿæˆä¸€å¼ å›¾åƒæœ€å¤šéœ€è¦30ç§’ã€‚æˆ‘ä»¬ä½¿ç”¨ **turbo mode** å¯ç”¨çš„Midjourneyå¸æˆ·ï¼Œæ‰€ä»¥é€šå¸¸éå¸¸å¿«ã€‚

è®©æˆ‘ä»¬åˆ›å»ºä¸€ä¸ªæ–°æ–‡ä»¶æ¥è·å–æˆ‘ä»¬åœ¨[ä¸Šä¸€æ­¥](#ç”Ÿæˆä¸€å¼ å›¾ç‰‡)ä¸­åˆ›å»ºçš„å›¾åƒã€‚

```js filename="get-image.js" copy showLineNumbers

const imageId = '7f360434-675f-4abb-8cca-1ca0bca6f1a6'; // <<< TODO: æ›´æ”¹ä¸ºå›¾åƒIDï¼ˆæ‚¨ä»ä¸Šä¸€ä¸ªè¯·æ±‚ä¸­å¾—åˆ°çš„IDï¼‰

async function main() {
  try {
    const response = await fetch(`https://demo.imagineapi.dev/items/images/${imageId}`, {
      method: 'GET',
      headers: {
        'Authorization': 'Bearer u667iLDO2Xfu0-qpv_nu82EeeDtYGlsf', // <<<< TODO: è®°å¾—æ›´æ”¹è¿™ä¸ª
        'Content-Type': 'application/json'
      }
    })

    const responseData = await response.json();
    console.log(responseData)
  } catch (error) {
    console.error('å‡ºé”™äº†', error);
    throw error;
  }
}

main();
```

ç„¶åæˆ‘ä»¬è¿è¡Œå®ƒï¼ˆéœ€è¦Node.js 18æˆ–æ›´é«˜ç‰ˆæœ¬ï¼‰ï¼š

```sh
â¯ node --version
v18.14.0

â¯ node get-image.js
```

å¦‚æœå›¾åƒå®Œæˆç”Ÿæˆï¼Œè¿™æ˜¯æˆ‘ä»¬å¾—åˆ°çš„ç»“æœï¼š


```js
{
  data: {
    id: '8fd5bc67-a4c5-4bf0-a09d-e20341d17135',
    prompt: 'a pretty lady at the beach --ar 9:21 --chaos 40 --stylize 1000',
    results: 'e779c669-fa11-4dce-968e-bb673d16f48c',
    user_created: '4df804f1-e32e-4e1c-be58-6acbe48cce98',
    date_created: '2023-09-01T04:33:44.939Z',
    status: 'completed',
    progress: null,
    url: 'https://demo.imagineapi.dev/assets/e779c669-fa11-4dce-968e-bb673d16f48c/e779c669-fa11-4dce-968e-bb673d16f48c.png',
    error: null,
    upscaled_urls: [
      'https://demo.imagineapi.dev/assets/591495eb-5db5-4b85-a3aa-d06309b614ed/591495eb-5db5-4b85-a3aa-d06309b614ed.png',
      'https://demo.imagineapi.dev/assets/fdb55e69-5c15-4846-8050-d6ae991657c1/fdb55e69-5c15-4846-8050-d6ae991657c1.png',
      'https://demo.imagineapi.dev/assets/b625e482-a91f-4451-8086-6d6eeb0e9bd7/b625e482-a91f-4451-8086-6d6eeb0e9bd7.png',
      'https://demo.imagineapi.dev/assets/7ef88522-f4d1-4ed3-9f52-6306cca167a6/7ef88522-f4d1-4ed3-9f52-6306cca167a6.png'
    ],
    upscaled: [
      '591495eb-5db5-4b85-a3aa-d06309b614ed',
      '7ef88522-f4d1-4ed3-9f52-6306cca167a6',
      'b625e482-a91f-4451-8086-6d6eeb0e9bd7',
      'fdb55e69-5c15-4846-8050-d6ae991657c1'
    ]
  }
}
```


### è‡ªåŠ¨ç­‰å¾…å›¾åƒ

è®©æˆ‘ä»¬å–ä¸‹[ç”Ÿæˆå›¾åƒçš„ä»£ç ç‰‡æ®µ](#%E7%94%9F%E6%88%90%E5%9B%BE%E7%89%87)ï¼Œå¹¶è®©å®ƒæ¯ 5 ç§’æ£€æŸ¥ä¸€æ¬¡å›¾åƒæ˜¯å¦å·²ç”Ÿæˆï¼ˆå³ status æ˜¯ completed æˆ– failedï¼‰ï¼š

```js filename="midjourney-api.js" copy showLineNumbers {9-10, 21-22, 28-53}
// ä½¿ç”¨ fetch â€”â€” éœ€è¦ Node.js 18 æˆ–æ›´é«˜ç‰ˆæœ¬

const data = {
    prompt: "a pretty lady at the beach --ar 9:21 --chaos 40 --stylize 1000"
};

// æˆ‘ä»¬åœ¨è¿™é‡Œå°†å…¶åŒ…è£…åœ¨ä¸€ä¸ªä¸»å‡½æ•°ä¸­ï¼Œä»¥ä¾¿æˆ‘ä»¬å¯ä»¥åœ¨å…¶ä¸­ä½¿ç”¨ async/awaitã€‚
async function main() {
    let promptResponseData;
    // ç”Ÿæˆå›¾åƒ
    try {
        const response = await fetch('https://demo.imagineapi.dev/items/images/', {
            method: 'POST',
            headers: {
                'Authorization': 'Bearer u667iLDO2Xfu0-qpv_nu82EeeDtYGlsf', // <<<< TODO: è®°å¾—æ›´æ”¹è¿™ä¸ª
                'Content-Type': 'application/json'
            },
            body: JSON.stringify(data)
        });

        promptResponseData = await response.json();
        console.log(promptResponseData);
    } catch (error) {
        console.error('ç”Ÿæˆå›¾ç‰‡æ—¶å‡ºé”™ï¼š', error);
        throw error;
    }

    // æ£€æŸ¥å›¾åƒæ˜¯å¦å·²å®Œæˆç”Ÿæˆ
    // æˆ‘ä»¬æ¯ 5000 æ¯«ç§’ï¼ˆ5 ç§’ï¼Œè®¾ç½®åœ¨åº•éƒ¨ï¼‰é‡å¤æ­¤ä»£ç 
    const intervalId = setInterval(async function () {
        try {
          console.log('æ­£åœ¨æ£€æŸ¥å›¾åƒè¯¦æƒ…');
          const response = await fetch(`https://demo.imagineapi.dev/items/images/${promptResponseData.data.id}`, {
            method: 'GET',
            headers: {
                'Authorization': 'Bearer u667iLDO2Xfu0-qpv_nu82EeeDtYGlsf', // <<<< TODO: è®°å¾—æ›´æ”¹è¿™ä¸ª
                'Content-Type': 'application/json'
            }
          })

          const responseData = await response.json();
          if (responseData.data.status === 'completed' || responseData.data.status === 'failed') {
            // åœæ­¢é‡å¤
            clearInterval(intervalId);
            console.log('å®Œæˆçš„å›¾åƒè¯¦æƒ…', responseData.data);
          } else {
            console.log("å›¾åƒå°šæœªå®Œæˆç”Ÿæˆã€‚çŠ¶æ€ï¼š", responseData.data.status)
          }
        } catch (error) {
          console.error('è·å–æ›´æ–°æ—¶å‡ºé”™', error);
          throw error;
        }
    }, 5000 /* æ¯ 5 ç§’ */);
    // TODO: æ·»åŠ æ£€æŸ¥ä»¥ç¡®ä¿è¿™ä¸ä¼šæ— é™æœŸè¿è¡Œ
}

main();
```

è¾“å‡ºå¯èƒ½å¦‚ä¸‹æ‰€ç¤ºï¼š


```js
{
  data: {
    id: '96e8c151-085f-4e1b-a3be-36dcff594dbd',
    prompt: 'a pretty lady at the beach --ar 9:21 --chaos 40 --stylize 1000',
    results: null,
    user_created: '4df804f1-e32e-4e1c-be58-6acbe48cce98',
    date_created: '2023-09-01T04:36:06.549Z',
    status: 'pending',
    progress: null,
    url: null,
    error: null,
    upscaled_urls: null,
    upscaled: []
  }
}
æ­£åœ¨æ£€æŸ¥å›¾åƒè¯¦æƒ…
å›¾åƒå°šæœªå®Œæˆç”Ÿæˆã€‚çŠ¶æ€ï¼š pending
æ­£åœ¨æ£€æŸ¥å›¾åƒè¯¦æƒ…
å›¾åƒå°šæœªå®Œæˆç”Ÿæˆã€‚çŠ¶æ€ï¼š pending
æ­£åœ¨æ£€æŸ¥å›¾åƒè¯¦æƒ…
å›¾åƒå°šæœªå®Œæˆç”Ÿæˆã€‚çŠ¶æ€ï¼š pending
æ­£åœ¨æ£€æŸ¥å›¾åƒè¯¦æƒ…
å›¾åƒå°šæœªå®Œæˆç”Ÿæˆã€‚çŠ¶æ€ï¼š pending
æ­£åœ¨æ£€æŸ¥å›¾åƒè¯¦æƒ…
å›¾åƒå°šæœªå®Œæˆç”Ÿæˆã€‚çŠ¶æ€ï¼š in-progress
æ­£åœ¨æ£€æŸ¥å›¾åƒè¯¦æƒ…
å›¾åƒå°šæœªå®Œæˆç”Ÿæˆã€‚çŠ¶æ€ï¼š in-progress
æ­£åœ¨æ£€æŸ¥å›¾åƒè¯¦æƒ…
å›¾åƒå°šæœªå®Œæˆç”Ÿæˆã€‚çŠ¶æ€ï¼š in-progress
æ­£åœ¨æ£€æŸ¥å›¾åƒè¯¦æƒ…
å›¾åƒå°šæœªå®Œæˆç”Ÿæˆã€‚çŠ¶æ€ï¼š in-progress
æ­£åœ¨æ£€æŸ¥å›¾åƒè¯¦æƒ…
å›¾åƒå°šæœªå®Œæˆç”Ÿæˆã€‚çŠ¶æ€ï¼š in-progress
æ­£åœ¨æ£€æŸ¥å›¾åƒè¯¦æƒ…
å®Œæˆçš„å›¾åƒè¯¦æƒ… {
  id: '96e8c151-085f-4e1b-a3be-36dcff594dbd',
  prompt: 'a pretty lady at the beach --ar 9:21 --chaos 40 --stylize 1000',
  results: 'ad2fd5e8-09f5-49ed-b00c-c4ce492deb6b',
  user_created: '4df804f1-e32e-4e1c-be58-6acbe48cce98',
  date_created: '2023-09-01T04:36:06.549Z',
  status: 'completed',
  progress: null,
  url: 'https://demo.imagineapi.dev/assets/ad2fd5e8-09f5-49ed-b00c-c4ce492deb6b/ad2fd5e8-09f5-49ed-b00c-c4ce492deb6b.png',
  error: null,
  upscaled_urls: [
    'https://demo.imagineapi.dev/assets/426e213c-8ace-462e-b62c-ba1b63ace088/426e213c-8ace-462e-b62c-ba1b63ace088.png',
    'https://demo.imagineapi.dev/assets/665b2bf2-66ea-4a18-a3f5-5532edd4d2e1/665b2bf2-66ea-4a18-a3f5-5532edd4d2e1.png',
    'https://demo.imagineapi.dev/assets/a73df4d2-3d3d-418f-bc56-8d338b2f33a4/a73df4d2-3d3d-418f-bc56-8d338b2f33a4.png',
    'https://demo.imagineapi.dev/assets/c6dd3426-dcf1-4753-ba64-a9bcacbd0723/c6dd3426-dcf1-4753-ba64-a9bcacbd0723.png'
  ],
  upscaled: [
    '426e213c-8ace-462e-b62c-ba1b63ace088',
    '665b2bf2-66ea-4a18-a3f5-5532edd4d2e1',
    'a73df4d2-3d3d-418f-bc56-8d338b2f33a4',
    'c6dd3426-dcf1-4753-ba64-a9bcacbd0723'
  ]
}
```

`upscaled_urls` çš„æ ·å­å¦‚ä¸‹ï¼š
![è‡ªåŠ¨æ”¾å¤§çš„ Midjourney å›¾åƒ](/upscaled-results.png)

</Steps>
