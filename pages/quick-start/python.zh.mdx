import { Callout, Tab, Tabs, Steps } from 'nextra/components'

ä½¿ç”¨Pythonä¸æˆ‘ä»¬çš„Midjourney API

## æ¦‚è¿°

æœ¬æŒ‡å—å‡å®šæ‚¨æ­£åœ¨ä½¿ç”¨[æ¼”ç¤ºå¸æˆ·](https://www.imagineapi.dev/pricing)ã€‚æˆ‘ä»¬å°†é€šè¿‡ç”Ÿæˆä¸€å¼ å›¾ç‰‡å¹¶æŸ¥çœ‹ç»“æœæ¥å¿«é€Ÿå¼€å§‹ã€‚æ‚¨ä¹Ÿå¯ä»¥é€‰æ‹©ä½¿ç”¨çš„ç¼–ç¨‹è¯­è¨€ã€‚

æœ€å¥½çš„éƒ¨åˆ†æ˜¯ï¼Œæ‚¨å¯ä»¥å¤åˆ¶ä»£ç å¹¶ç«‹å³ä½¿ç”¨ï¼

<Callout type="info" emoji="ğŸš€">
**é€šè¿‡è·å–[æ¼”ç¤ºå¸æˆ·](https://www.imagineapi.dev/pricing)æœ€ç®€å•çš„å¼€å§‹ç”ŸæˆMidjourneyå›¾ç‰‡çš„æ–¹æ³•ã€‚**
</Callout>

<Steps>

### è·å–èº«ä»½éªŒè¯ä»¤ç‰Œ

![ç”Ÿæˆèº«ä»½éªŒè¯ä»¤ç‰Œçš„æ­¥éª¤åŠ¨ç”»](/authentication.gif)

1. ä¸€æ—¦è´­ä¹°äº†[æ¼”ç¤ºå¸æˆ·](https://www.imagineapi.dev/pricing)ï¼Œæ‚¨å°†æ”¶åˆ°ä¸€å°åŒ…å«ç”¨æˆ·åå’Œå¯†ç çš„ç”µå­é‚®ä»¶ã€‚ä½¿ç”¨å®ƒç™»å½•åˆ°æˆ‘ä»¬çš„æ¼”ç¤ºæœåŠ¡å™¨ï¼š[https://cl.imagineapi.dev](https://cl.imagineapi.dev)ã€‚
1. ç™»å½•åï¼Œç‚¹å‡»å·¦ä¸‹è§’çš„ `ç”¨æˆ·å›¾æ ‡`ï¼š![](/authentication-token.png)
1. è¿™æ˜¯æ‚¨çš„ç”¨æˆ·è®¾ç½®ã€‚æ»šåŠ¨åˆ°åº•éƒ¨ï¼Œæ‰¾åˆ° `Token` å­—æ®µå¹¶ `ç‚¹å‡»åœ†å½¢ç®­å¤´æŒ‰é’®` ä»¥é‡æ–°ç”Ÿæˆä»¤ç‰Œï¼š![](/authentication-click-regenerate.png)
1. è¿™å°†åˆ›å»ºä¸€ä¸ªæ–°çš„ä»¤ç‰Œï¼Œæ‚¨å¯ä»¥ç”¨å®ƒæ¥æˆæƒæ‚¨çš„APIè°ƒç”¨ï¼Œæ‰€ä»¥ `å¤åˆ¶è¯¥ä»¤ç‰Œ`ã€‚è¯·å°†å®ƒä¿å­˜åœ¨æŸä¸ªæ–‡ä»¶ä¸­ï¼Œå› ä¸ºæ‚¨å¾ˆå¿«å°±ä¼šç”¨åˆ°å®ƒï¼š![](/authentication-copy-token.png)
1. ç„¶å `ç‚¹å‡»å³ä¸Šè§’çš„å¤é€‰æ¡†æŒ‰é’®` ä»¥ä¿å­˜æ‚¨çš„å¸æˆ·æ›´æ”¹ï¼š![](/authentication-save-account-changes.png)

å°±æ˜¯è¿™æ ·ã€‚ç°åœ¨æˆ‘ä»¬å°†ä½¿ç”¨è¯¥ä»¤ç‰Œæ¥éªŒè¯æˆ‘ä»¬çš„APIè°ƒç”¨ã€‚

### ç”Ÿæˆä¸€å¼ å›¾ç‰‡

ç°åœ¨æ‚¨æ‹¥æœ‰æ‚¨çš„[èº«ä»½éªŒè¯ä»¤ç‰Œ](#è·å–èº«ä»½éªŒè¯ä»¤ç‰Œ)ï¼Œæ‚¨å¯ä»¥ç”Ÿæˆæ‚¨çš„ç¬¬ä¸€å¼ å›¾ç‰‡ã€‚

```python filename="midjourney_api.py" copy showLineNumbers
import http.client
import json
import pprint

data = {
    "prompt": "a pretty lady at the beach --ar 9:21 --chaos 40 --stylize 1000"
}

headers = {
    'Authorization': 'Bearer u667iLDO2Xfu0-qpv_nu82EeeDtYGlsf',  # <<<< TODO: è®°å¾—æ›´æ”¹è¿™ä¸ª
    'Content-Type': 'application/json'
}

conn = http.client.HTTPSConnection("cl.imagineapi.dev")
conn.request("POST", "/items/images/", body=json.dumps(data), headers=headers)

response = conn.getresponse()
response_data = json.loads(response.read().decode('utf-8'))

pprint.pp(response_data)
```

æˆ‘ä»¬ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤è¿è¡Œå®ƒï¼š

```shell
â¯ python3 --version
Python 3.11.5

â¯ python midjourney_api.py
```

è¾“å‡ºå°†å¦‚ä¸‹æ‰€ç¤ºï¼š

```python
{  'data': {  'date_created': '2023-09-18T22:34:10.127Z',
              'error': None,
              'id': 'd85674b8-106a-45b2-9514-04331e80127c',
              'progress': None,
              'prompt': 'a pretty lady at the beach --ar 9:21 --chaos 40 '
                        '--stylize 1000',
              'results': None,
              'status': 'pending',
              'upscaled': [],
              'upscaled_urls': None,
              'url': None,
              'user_created': '126353b1-2c3e-42af-9597-b141c0e50fae'}}
```

ç°åœ¨æ‚¨çš„æç¤ºå°†è¢«å‘é€åˆ°Midjourneyã€‚

éœ€è¦æ³¨æ„çš„ä¸€äº›é‡è¦ç»†èŠ‚ï¼š

- å›¾åƒ `id` å°†ä¿æŒä¸å˜ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨å®ƒæ¥è·å–æ•°æ®å’ŒçŠ¶æ€
- `status` æ˜¯ `pending`ï¼Œè¿™æ˜¯é¦–æ¬¡åˆ›å»ºå›¾åƒç”Ÿæˆæ—¶çš„é»˜è®¤å€¼
- å½“å®Œæˆç”Ÿæˆï¼ˆ`status` å°†ä¸º `completed`ï¼‰æ—¶ï¼Œ`upscaled_urls` å°†å…·æœ‰4ä¸ªç‹¬ç«‹çš„å›¾åƒURLï¼Œè€Œ `url` å°†å…·æœ‰å…¶ä¸­åŒ…å«æ‰€æœ‰å››ä¸ªå›¾åƒçš„ç½‘æ ¼å›¾åƒ

è®©æˆ‘ä»¬ç»§ç»­ä¸‹é¢ï¼Œå¹¶[è·å–ç”Ÿæˆçš„å›¾åƒ](#è·å–ç”Ÿæˆçš„å›¾åƒ)ã€‚

### è·å–ç”Ÿæˆçš„å›¾åƒ

åœ¨æ¼”ç¤ºæœåŠ¡å™¨ä¸­ç”Ÿæˆä¸€å¼ å›¾åƒæœ€å¤šéœ€è¦30ç§’ã€‚æˆ‘ä»¬ä½¿ç”¨ **turbo mode** å¯ç”¨çš„Midjourneyå¸æˆ·ï¼Œæ‰€ä»¥é€šå¸¸éå¸¸å¿«ã€‚

è®©æˆ‘ä»¬åˆ›å»ºä¸€ä¸ªæ–°æ–‡ä»¶æ¥è·å–æˆ‘ä»¬åœ¨[ä¸Šä¸€æ­¥](#ç”Ÿæˆä¸€å¼ å›¾ç‰‡)ä¸­åˆ›å»ºçš„å›¾åƒã€‚

```python filename="get_image.py" copy showLineNumbers
import http.client
import json
import pprint

image_id = 'd85674b8-106a-45b2-9514-04331e80127c'  # TODOï¼šå°†æ­¤æ›´æ”¹ä¸ºå›¾ç‰‡IDï¼ˆæ‚¨ä»ä¹‹å‰çš„è¯·æ±‚ä¸­è·å¾—çš„IDï¼‰

connection = http.client.HTTPSConnection("cl.imagineapi.dev")
headers = {
    'Authorization': 'Bearer u667iLDO2Xfu0-qpv_nu82EeeDtYGlsf',  # TODO: è®°å¾—æ›´æ”¹è¿™ä¸ª
    'Content-Type': 'application/json'
}

try:
    connection.request("GET", f"/items/images/{image_id}", headers=headers)
    response = connection.getresponse()
    data = json.loads(response.read().decode())
    pprint.pp(data, indent=4)
except Exception as error:
    print(f"Error: {error}")
```

ç„¶åæˆ‘ä»¬è¿è¡Œå®ƒï¼š

```sh
$ python3 --version
Python 3.11.5

$ python3 get_image.py
```

å¦‚æœå›¾åƒå®Œæˆç”Ÿæˆï¼Œè¿™æ˜¯æˆ‘ä»¬å¾—åˆ°çš„ç»“æœï¼š


```python
{'data': {'id': 'd85674b8-106a-45b2-9514-04331e80127c',
          'prompt': 'a pretty lady at the beach --ar 9:21 --chaos 40 --stylize '
                    '1000',
          'results': 'c167ecef-6f7c-4b94-8aba-6da282c14246',
          'user_created': '126353b1-2c3e-42af-9597-b141c0e50fae',
          'date_created': '2023-09-18T22:42:52.569Z',
          'status': 'completed',
          'progress': None,
          'url': 'https://cl.imagineapi.dev/assets/c167ecef-6f7c-4b94-8aba-6da282c14246/c167ecef-6f7c-4b94-8aba-6da282c14246.png',
          'error': None,
          'upscaled_urls': ['https://cl.imagineapi.dev/assets/05f05786-af1a-497e-9a7e-d0aa2add04a7/05f05786-af1a-497e-9a7e-d0aa2add04a7.png',
                            'https://cl.imagineapi.dev/assets/20984abb-a4a1-4376-b622-178ade59af14/20984abb-a4a1-4376-b622-178ade59af14.png',
                            'https://cl.imagineapi.dev/assets/c1f1be14-dcb8-4d34-9e4f-3e7fa9e58187/c1f1be14-dcb8-4d34-9e4f-3e7fa9e58187.png',
                            'https://cl.imagineapi.dev/assets/d82b5c66-7eca-406f-a210-cb645f06c936/d82b5c66-7eca-406f-a210-cb645f06c936.png'],
          'upscaled': ['05f05786-af1a-497e-9a7e-d0aa2add04a7',
                       '20984abb-a4a1-4376-b622-178ade59af14',
                       'c1f1be14-dcb8-4d34-9e4f-3e7fa9e58187',
                       'd82b5c66-7eca-406f-a210-cb645f06c936']}}
```

è¿™å¾ˆå¥½ï¼Œä½†å¦‚æœè„šæœ¬èƒ½è‡ªåŠ¨æ£€æŸ¥å›¾ç‰‡å¹¶åœ¨å®Œæˆåæ˜¾ç¤ºç»™æˆ‘ä»¬å°±æ›´å¥½äº†ã€‚


### è‡ªåŠ¨ç­‰å¾…å›¾åƒ

è®©æˆ‘ä»¬å–ä¸‹[ç”Ÿæˆå›¾åƒçš„ä»£ç ç‰‡æ®µ](#%E7%94%9F%E6%88%90%E5%9B%BE%E7%89%87)ï¼Œå¹¶è®©å®ƒæ¯ 5 ç§’æ£€æŸ¥ä¸€æ¬¡å›¾åƒæ˜¯å¦å·²ç”Ÿæˆï¼ˆå³ status æ˜¯ completed æˆ– failedï¼‰ï¼š

```python filename="midjourney_api.py" copy showLineNumbers {15-37}
import json
import time
import http.client
import pprint

data = {
    "prompt": "a pretty lady at the beach --ar 9:21 --chaos 40 --stylize 1000"
}

headers = {
    'Authorization': 'Bearer u667iLDO2Xfu0-qpv_nu82EeeDtYGlsf',  # <<<< TODO: è®°å¾—æ›´æ”¹è¿™ä¸ª
    'Content-Type': 'application/json'
}

def send_request(method, path, body=None, headers={}):
    conn = http.client.HTTPSConnection("cl.imagineapi.dev")
    conn.request(method, path, body=json.dumps(body) if body else None, headers=headers)
    response = conn.getresponse()
    data = json.loads(response.read().decode())
    conn.close()
    return data

prompt_response_data = send_request('POST', '/items/images/', data, headers)
pprint.pp(prompt_response_data)

def check_image_status():
    response_data = send_request('GET', f"/items/images/{prompt_response_data['data']['id']}", headers=headers)
    if response_data['data']['status'] in ['completed', 'failed']:
        print('å›¾ç‰‡å¤„ç†å®Œæˆ',)
        pprint.pp(response_data['data'])
        return True
    else:
        print(f"å›¾ç‰‡å°šæœªç”Ÿæˆå®Œæˆã€‚çŠ¶æ€ï¼š{response_data['data']['status']}")
        return False


while not check_image_status():
    time.sleep(5)  # wait for 5 seconds
```

è¾“å‡ºå¯èƒ½å¦‚ä¸‹æ‰€ç¤ºï¼š


```python
{'data': {'id': '51e351fc-cf44-4346-8b96-400560e8d3f4',
          'prompt': 'a pretty lady at the beach --ar 9:21 --chaos 40 --stylize '
                    '1000',
          'results': None,
          'user_created': '126353b1-2c3e-42af-9597-b141c0e50fae',
          'date_created': '2023-09-19T16:58:02.325Z',
          'status': 'pending',
          'progress': None,
          'url': None,
          'error': None,
          'upscaled_urls': None,
          'upscaled': []}}
å›¾ç‰‡å°šæœªç”Ÿæˆå®Œæˆã€‚çŠ¶æ€ï¼špending
å›¾ç‰‡å°šæœªç”Ÿæˆå®Œæˆã€‚çŠ¶æ€ï¼špending
å›¾ç‰‡å°šæœªç”Ÿæˆå®Œæˆã€‚çŠ¶æ€ï¼špending
å›¾ç‰‡å°šæœªç”Ÿæˆå®Œæˆã€‚çŠ¶æ€ï¼špending
å›¾ç‰‡å°šæœªç”Ÿæˆå®Œæˆã€‚çŠ¶æ€ï¼špending
å›¾ç‰‡å°šæœªç”Ÿæˆå®Œæˆã€‚çŠ¶æ€ï¼špending
å›¾ç‰‡å°šæœªç”Ÿæˆå®Œæˆã€‚çŠ¶æ€ï¼špending
å›¾ç‰‡å°šæœªç”Ÿæˆå®Œæˆã€‚çŠ¶æ€ï¼šin-progress
å›¾ç‰‡å°šæœªç”Ÿæˆå®Œæˆã€‚çŠ¶æ€ï¼šin-progress
å›¾ç‰‡å°šæœªç”Ÿæˆå®Œæˆã€‚çŠ¶æ€ï¼šin-progress
å›¾ç‰‡å°šæœªç”Ÿæˆå®Œæˆã€‚çŠ¶æ€ï¼šin-progress
å›¾ç‰‡å¤„ç†å®Œæˆ
{'id': '51e351fc-cf44-4346-8b96-400560e8d3f4',
 'prompt': 'a pretty lady at the beach --ar 9:21 --chaos 40 --stylize 1000',
 'results': '09cb71d2-a1e1-4347-abe7-368fc81327ea',
 'user_created': '126353b1-2c3e-42af-9597-b141c0e50fae',
 'date_created': '2023-09-19T16:58:02.325Z',
 'status': 'completed',
 'progress': None,
 'url': 'https://cl.imagineapi.dev/assets/09cb71d2-a1e1-4347-abe7-368fc81327ea/09cb71d2-a1e1-4347-abe7-368fc81327ea.png',
 'error': None,
 'upscaled_urls': ['https://cl.imagineapi.dev/assets/e4bc0749-c968-4178-9f27-7445412ee0b4/e4bc0749-c968-4178-9f27-7445412ee0b4.png',
                   'https://cl.imagineapi.dev/assets/fb51a55e-1d3e-43bd-9622-61bfba69a342/fb51a55e-1d3e-43bd-9622-61bfba69a342.png',
                   'https://cl.imagineapi.dev/assets/14b88d32-cc87-4029-91fd-574ff8ea0d2c/14b88d32-cc87-4029-91fd-574ff8ea0d2c.png',
                   'https://cl.imagineapi.dev/assets/9977909f-2f1b-421e-8c6e-deca1aea4059/9977909f-2f1b-421e-8c6e-deca1aea4059.png'],
 'upscaled': ['14b88d32-cc87-4029-91fd-574ff8ea0d2c',
              '9977909f-2f1b-421e-8c6e-deca1aea4059',
              'e4bc0749-c968-4178-9f27-7445412ee0b4',
              'fb51a55e-1d3e-43bd-9622-61bfba69a342']}
```

`upscaled_urls` çš„æ ·å­å¦‚ä¸‹ï¼š
![è‡ªåŠ¨æ”¾å¤§çš„ Midjourney å›¾åƒ](/upscaled-results-python.png)

</Steps>
