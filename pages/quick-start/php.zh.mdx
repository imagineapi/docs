import { Callout, Tab, Tabs, Steps } from 'nextra/components'

# ä½¿ç”¨PHPä¸æˆ‘ä»¬çš„Midjourney API

## æ¦‚è§ˆ

æœ¬æŒ‡å—å‡è®¾æ‚¨ä½¿ç”¨çš„æ˜¯[æ¼”ç¤ºå¸æˆ·](https://www.imagineapi.dev/pricing)ã€‚æˆ‘ä»¬å°†é€šè¿‡ç”Ÿæˆå›¾åƒå¹¶æŸ¥çœ‹ç»“æœå¿«é€Ÿå¼€å§‹ã€‚æ‚¨è¿˜å¯ä»¥é€‰æ‹©ä½¿ç”¨çš„è¯­è¨€ã€‚

æœ€å¥½çš„éƒ¨åˆ†æ˜¯æ‚¨å¯ä»¥å¤åˆ¶ä»£ç å¹¶ç«‹å³ä½¿ç”¨å®ƒï¼

<Callout type="info" emoji="ğŸš€">
**é€šè¿‡APIç”ŸæˆMidjourneyå›¾åƒçš„æœ€ç®€å•æ–¹æ³•æ˜¯è·å¾—[æ¼”ç¤ºå¸æˆ·](https://www.imagineapi.dev/pricing)ã€‚**
</Callout>

<Steps>

### è·å–è®¤è¯ä»¤ç‰Œ

![ç”Ÿæˆè®¤è¯ä»¤ç‰Œçš„æ­¥éª¤åŠ¨ç”»](/authentication.gif)

 1. ä¸€æ—¦æ‚¨è´­ä¹°äº†[æ¼”ç¤ºå¸æˆ·](https://www.imagineapi.dev/pricing)ï¼Œæ‚¨å°†æ”¶åˆ°ä¸€ä¸ªç”µå­é‚®ä»¶ç”¨æˆ·åå’Œå¯†ç ã€‚ä½¿ç”¨å®ƒç™»å½•æˆ‘ä»¬çš„æ¼”ç¤ºæœåŠ¡å™¨ï¼š[https://demo.imagineapi.dev](https://demo.imagineapi.dev)ã€‚
 1. ç™»å½•åï¼Œç‚¹å‡»å·¦ä¸‹è§’çš„`ç”¨æˆ·å›¾æ ‡`ï¼š![ImagineAPIçš„ç”¨æˆ·å›¾æ ‡æˆªå›¾](/authentication-token.png)
 1. è¿™äº›æ˜¯æ‚¨çš„ç”¨æˆ·è®¾ç½®ã€‚æ»šåŠ¨åˆ°åº•éƒ¨ï¼Œæ‰¾åˆ°`Token`å­—æ®µå¹¶`ç‚¹å‡»åœ†å½¢ç®­å¤´æŒ‰é’®`ä»¥é‡æ–°ç”Ÿæˆä»¤ç‰Œï¼š![](/authentication-click-regenerate.png)
 1. è¿™å°†åˆ›å»ºä¸€ä¸ªæ–°çš„ä»¤ç‰Œï¼Œæ‚¨å¯ä»¥ä½¿ç”¨å®ƒæ¥æˆæƒæ‚¨çš„APIè°ƒç”¨ï¼Œæ‰€ä»¥`å¤åˆ¶è¯¥ä»¤ç‰Œ`ã€‚è¯·å°†å…¶ä¿å­˜åœ¨æŸä¸ªæ–‡ä»¶ä¸­ï¼Œå› ä¸ºæ‚¨å°†å¾ˆå¿«ä½¿ç”¨å®ƒï¼š![](/authentication-copy-token.png)
 1. ç„¶ååœ¨å³ä¸Šè§’`ç‚¹å‡»å¤é€‰æ¡†æŒ‰é’®`ä»¥ä¿å­˜æ‚¨çš„å¸æˆ·æ›´æ”¹ï¼š![ä¸ºä»¤ç‰Œä¿å­˜å¸æˆ·è¯¦ç»†ä¿¡æ¯](/authentication-save-account-changes.png)

å°±è¿™æ ·ã€‚ç°åœ¨æˆ‘ä»¬å°†ä½¿ç”¨è¯¥ä»¤ç‰Œå¯¹æˆ‘ä»¬çš„APIè°ƒç”¨è¿›è¡Œèº«ä»½éªŒè¯ã€‚

### ç”Ÿæˆå›¾åƒ

ç°åœ¨æ‚¨æ‹¥æœ‰äº†[è®¤è¯ä»¤ç‰Œ](#get-the-authentication-token)ï¼Œæ‚¨å¯ä»¥ç”Ÿæˆç¬¬ä¸€å¼ å›¾åƒã€‚

```php filename="midjourney-api.php" copy showLineNumbers
<?php
$data = [
    'prompt' => 'a pretty lady at the beach --ar 9:21 --chaos 40 --stylize 1000'
];

$url = 'https://demo.imagineapi.dev/items/images/';

$headers = [
    "Authorization: Bearer u667iLDO2Xfu0-qpv_nu82EeeDtYGlsf", # <<<< TODO æ›´æ”¹è¿™é‡Œçš„APIå¯†é’¥

    "Content-Type: application/json"
];


$options = [
    'http' => [
        'method' => 'POST',
        'header' => join("\r\n", $headers),
        'content' => json_encode($data)
    ]
];

$context = stream_context_create($options);
$response = file_get_contents($url, false, $context);
$responseData = json_decode($response, true);

echo json_encode($responseData, JSON_UNESCAPED_SLASHES) . "\n";
?>
```

æˆ‘ä»¬ä½¿ç”¨(PHP7+æ˜¯å¿…éœ€çš„)è¿è¡Œå®ƒï¼š

```shell
â¯ php --version
PHP 8.2.10 (cli) (built: Aug 31 2023 18:52:55) (NTS)
Copyright (c) The PHP Group
Zend Engine v4.2.10, Copyright (c) Zend Technologies
    with Zend OPcache v8.2.10, Copyright (c), by Zend Technologies

â¯ php midjourney-api.php
```

è¾“å‡ºå°†å¦‚ä¸‹æ‰€ç¤ºï¼š

```js
{
    "data": {
        "id": "7de767f8-f7ef-425d-b967-3df8670efd39",
        "prompt": "a pretty lady at the beach --ar 9:21 --chaos 40 --stylize 1000",
        "results": null,
        "user_created": "126353b1-2c3e-42af-9597-b141c0e50fae",
        "date_created": "2023-09-18T18:38:05.077Z",
        "status": "pending",
        "progress": null,
        "url": null,
        "error": null,
        "upscaled_urls": null,
        "upscaled": []
    }
}
```

ç°åœ¨æ‚¨çš„æç¤ºå°†è¢«å‘é€åˆ°Midjourneyã€‚

éœ€è¦æ³¨æ„çš„å‡ ä¸ªé‡è¦ç»†èŠ‚ï¼š

- å›¾åƒ`id`å°†ä¿æŒä¸å˜ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨å®ƒè·å–æ•°æ®å’ŒçŠ¶æ€
- `status`æ˜¯`pending`ï¼Œè¿™æ˜¯å›¾åƒç”Ÿæˆé¦–æ¬¡åˆ›å»ºæ—¶çš„é»˜è®¤å€¼
- å½“ç”Ÿæˆå®Œæˆæ—¶ï¼ˆ`status`å°†ä¸º`completed`ï¼‰ï¼Œ`upscaled_urls`å°†æœ‰4ä¸ªç‹¬ç«‹çš„å›¾åƒURLï¼Œ`url`å°†æœ‰ä¸€ä¸ªåŒ…å«å…¶ä¸­çš„æ‰€æœ‰å››ä¸ªå›¾åƒçš„ç½‘æ ¼å›¾åƒ

è®©æˆ‘ä»¬ç»§ç»­ä¸‹é¢å¹¶[è·å–ç”Ÿæˆçš„å›¾åƒ](#è·å–ç”Ÿæˆçš„å›¾åƒ)ã€‚

### è·å–ç”Ÿæˆçš„å›¾åƒ

åœ¨æ¼”ç¤ºæœåŠ¡å™¨ä¸Šç”Ÿæˆå›¾åƒæœ€å¤šéœ€è¦30ç§’ã€‚æˆ‘ä»¬ä½¿ç”¨äº†å¯ç”¨äº†**æ¶¡è½®æ¨¡å¼**çš„Midjourneyå¸æˆ·ï¼Œæ‰€ä»¥é€šå¸¸éå¸¸å¿«ã€‚

è®©æˆ‘ä»¬åˆ›å»ºä¸€ä¸ªæ–°æ–‡ä»¶ï¼Œä»¥è·å–æˆ‘ä»¬åœ¨[ä¸Šä¸€æ­¥](#ç”Ÿæˆå›¾åƒ)ä¸­åˆ›å»ºçš„å›¾åƒã€‚

```php filename="get-image.php" copy showLineNumbers
<?php
$imageId = '7de767f8-f7ef-425d-b967-3df8670efd39'; // TODO: æ›´æ”¹è¿™ä¸ª

$url = 'https://demo.imagineapi.dev/items/images/' . $imageId;
$headers = [
    'Authorization: Bearer u667iLDO2Xfu0-qpv_nu82EeeDtYGlsf', // TODO: è®°å¾—æ›´æ”¹è¿™ä¸ª
];


$options = [
    'http' => [
        'method' => 'GET',
        'header' => join("\r\n", $headers)
    ]
];

$context = stream_context_create($options);
$response = file_get_contents($url, false, $context);
$responseData = json_decode($response, true);

echo json_encode($responseData, JSON_UNESCAPED_SLASHES) . "\n";
?>
```

æˆ‘ä»¬ä½¿ç”¨(PHP7+æ˜¯å¿…éœ€çš„)è¿è¡Œå®ƒï¼š

```shell
â¯ php --version
PHP 8.2.10 (cli) (built: Aug 31 2023 18:52:55) (NTS)
Copyright (c) The PHP Group
Zend Engine v4.2.10, Copyright (c) Zend Technologies
    with Zend OPcache v8.2.10, Copyright (c), by Zend Technologies

â¯ php get-image.php
```

è¾“å‡ºå°†å¦‚ä¸‹æ‰€ç¤ºï¼š

```js
{
    "data": {
        "id": "7de767f8-f7ef-425d-b967-3df8670efd39",
        "prompt": "a pretty lady at the beach --ar 9:21 --chaos 40 --stylize 1000",
        "results": "fa7546d9-ece9-4168-ba53-e750a2d5dd09",
        "user_created": "126353b1-2c3e-42af-9597-b141c0e50fae",
        "date_created": "2023-09-18T19:51:51.998Z",
        "status": "completed",
        "progress": null,
        "url": "https://demo.imagineapi.dev/assets/fa7546d9-ece9-4168-ba53-e750a2d5dd09/fa7546d9-ece9-4168-ba53-e750a2d5dd09.png",
        "error": null,
        "upscaled_urls": [
            "https://demo.imagineapi.dev/assets/13bcc54e-778a-4726-8a0e-85c7a927d1da/13bcc54e-778a-4726-8a0e-85c7a927d1da.png",
            "https://demo.imagineapi.dev/assets/283ef97a-34db-4d42-b4ec-62526be8c1ed/283ef97a-34db-4d42-b4ec-62526be8c1ed.png",
            "https://demo.imagineapi.dev/assets/04d84761-3552-45f4-ac9e-d223ad68c03d/04d84761-3552-45f4-ac9e-d223ad68c03d.png",
            "https://demo.imagineapi.dev/assets/741c0569-bb9b-4986-b99a-622ee4a308ee/741c0569-bb9b-4986-b99a-622ee4a308ee.png"
        ],
        "upscaled": [
            "04d84761-3552-45f4-ac9e-d223ad68c03d",
            "13bcc54e-778a-4726-8a0e-85c7a927d1da",
            "283ef97a-34db-4d42-b4ec-62526be8c1ed",
            "741c0569-bb9b-4986-b99a-622ee4a308ee"
        ]
    }
}
```

è¿™å¾ˆå¥½ï¼Œä½†å¦‚æœè„šæœ¬èƒ½è‡ªåŠ¨æ£€æŸ¥å›¾ç‰‡å¹¶åœ¨å®Œæˆæ—¶æ˜¾ç¤ºç»™æˆ‘ä»¬å°±æ›´å¥½äº†ï¼š

### è‡ªåŠ¨ç­‰å¾…å›¾åƒ

è®©æˆ‘ä»¬æ‹¿è¿™æ®µ[ç”Ÿæˆå›¾åƒçš„ä»£ç ](#generating-an-image)ï¼Œå¹¶è®©å®ƒæ¯5ç§’æ£€æŸ¥ä¸€æ¬¡å›¾åƒæ˜¯å¦å·²ç»ç”Ÿæˆï¼ˆå³ `status` æ˜¯ `completed` æˆ– `failed`ï¼‰ï¼š

```php filename="midjourney-api.php" copy showLineNumbers {27, 31-58}
<?php
$data = [
    'prompt' => 'a pretty lady at the beach --ar 9:21 --chaos 40 --stylize 1000'
];

$url = 'https://demo.imagineapi.dev/items/images/';

$headers = [
    "Authorization: Bearer u667iLDO2Xfu0-qpv_nu82EeeDtYGlsf", # <<<< TODO æ›´æ”¹æ­¤å¤„çš„APIå¯†é’¥
    "Content-Type: application/json"
];


$options = [
    'http' => [
        'method' => 'POST',
        'header' => join("\r\n", $headers),
        'content' => json_encode($data)
    ]
];

$context = stream_context_create($options);
$response = file_get_contents($url, false, $context);
$responseData = json_decode($response, true);


// åˆå§‹å“åº”
echo json_encode($responseData, JSON_UNESCAPED_SLASHES) . "\n";


// è½®è¯¢ä»¥å®Œæˆ
while (true) {
    sleep(5); // ç­‰å¾…5ç§’

    $imageId = $responseData['data']['id'];
    $url = 'https://demo.imagineapi.dev/items/images/' . $imageId;

    $options = [
        'http' => [
            'method' => 'GET',
            'header' => join("\r\n", $headers),
        ]
    ];

    $innerContext = stream_context_create($options);

    $response = file_get_contents($url, false, $innerContext);
    $checkData = json_decode($response, true);

    if ($checkData['data']['status'] === 'completed' || $checkData['data']['status'] === 'failed') {
        // å½“å›¾åƒå®Œæˆæˆ–å¤±è´¥æ—¶åœæ­¢
        echo json_encode($checkData, JSON_UNESCAPED_SLASHES) . "\n";
        break;
    } else {
        echo "å›¾åƒå°šæœªå®Œæˆç”Ÿæˆã€‚çŠ¶æ€ï¼š" . $checkData['data']['status'] . "\n";
    }
    // TODO: æ·»åŠ æ£€æŸ¥ä»¥ç¡®ä¿è¿™ä¸ä¼šæ— é™è¿è¡Œ
}
?>
```

ä»¥ä¸‹æ˜¯è¾“å‡ºå¯èƒ½çš„æ ·å­ï¼š

```js
{
    "data": {
        "id": "e91f5fb0-687f-4c90-83ee-36be3e6ebc7c",
        "prompt": "a pretty lady at the beach --ar 9:21 --chaos 40 --stylize 1000",
        "results": null,
        "user_created": "126353b1-2c3e-42af-9597-b141c0e50fae",
        "date_created": "2023-09-18T20:00:05.236Z",
        "status": "pending",
        "progress": null,
        "url": null,
        "error": null,
        "upscaled_urls": null,
        "upscaled": []
    }
}
å›¾åƒå°šæœªå®Œæˆç”Ÿæˆã€‚çŠ¶æ€ï¼špending
å›¾åƒå°šæœªå®Œæˆç”Ÿæˆã€‚çŠ¶æ€ï¼špending
å›¾åƒå°šæœªå®Œæˆç”Ÿæˆã€‚çŠ¶æ€ï¼špending
å›¾åƒå°šæœªå®Œæˆç”Ÿæˆã€‚çŠ¶æ€ï¼špending
å›¾åƒå°šæœªå®Œæˆç”Ÿæˆã€‚çŠ¶æ€ï¼špending
å›¾åƒå°šæœªå®Œæˆç”Ÿæˆã€‚çŠ¶æ€ï¼špending
å›¾åƒå°šæœªå®Œæˆç”Ÿæˆã€‚çŠ¶æ€ï¼šin-progress
å›¾åƒå°šæœªå®Œæˆç”Ÿæˆã€‚çŠ¶æ€ï¼šin-progress
å›¾åƒå°šæœªå®Œæˆç”Ÿæˆã€‚çŠ¶æ€ï¼šin-progress
å›¾åƒå°šæœªå®Œæˆç”Ÿæˆã€‚çŠ¶æ€ï¼šin-progress
å›¾åƒå°šæœªå®Œæˆç”Ÿæˆã€‚çŠ¶æ€ï¼šin-progress
{
    "data": {
        "id": "e91f5fb0-687f-4c90-83ee-36be3e6ebc7c",
        "prompt": "a pretty lady at the beach --ar 9:21 --chaos 40 --stylize 1000",
        "results": "20ed45fc-a51e-45bb-816f-07f66e0989b3",
        "user_created": "126353b1-2c3e-42af-9597-b141c0e50fae",
        "date_created": "2023-09-18T20:00:05.236Z",
        "status": "completed",
        "progress": null,
        "url": "https://demo.imagineapi.dev/assets/20ed45fc-a51e-45bb-816f-07f66e0989b3/20ed45fc-a51e-45bb-816f-07f66e0989b3.png",
        "error": null,
        "upscaled_urls": [
            "https://demo.imagineapi.dev/assets/1339d698-abe4-4885-a758-b8d9fe5116a0/1339d698-abe4-4885-a758-b8d9fe5116a0.png",
            "https://demo.imagineapi.dev/assets/16776c5e-cde6-4281-9be7-e302368b003f/16776c5e-cde6-4281-9be7-e302368b003f.png",
            "https://demo.imagineapi.dev/assets/fc25b62d-ad85-4669-a2a7-9e586fcb93b3/fc25b62d-ad85-4669-a2a7-9e586fcb93b3.png",
            "https://demo.imagineapi.dev/assets/006e9cdd-62cf-4c3f-9f94-f81e44b812ef/006e9cdd-62cf-4c3f-9f94-f81e44b812ef.png"
        ],
        "upscaled": [
            "006e9cdd-62cf-4c3f-9f94-f81e44b812ef",
            "1339d698-abe4-4885-a758-b8d9fe5116a0",
            "16776c5e-cde6-4281-9be7-e302368b003f",
            "fc25b62d-ad85-4669-a2a7-9e586fcb93b3"
        ]
    }
}
```

è¿™æ˜¯ `upscaled_urls` çš„æ ·å­ï¼š
![è‡ªåŠ¨æ”¾å¤§çš„Midjourneyå›¾åƒ](/upscaled-results-php.png)

</Steps>